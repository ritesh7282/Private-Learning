name: PRAT-CTAP-Jfrog-ECR-Dev

on:
  workflow_dispatch:
    inputs:
      AWS_Region:
        type: choice
        description: 'AWS Region'
        required: true
        options: 
        - eu-west-1
      
      SOURCE_ENVIRONMENT:
        type: choice
        description: 'Select Source Environment'
        required: true
        options: 
        - dev-ecr   
      
      TARGET_ENVIRONMENT:
        type: choice
        description: 'Select Target Environment'
        required: true
        options: 
        - jfrog       

      ARTIFACTORY_URL:
        description: 'Provide Jfrog Artifactory URL'
        required: true
        default: 'https://prat-ctap-shared-market-dev.dock.merck.com'

      ARTIFACTORY_REPO:
        description: 'Provide Jfrog Artifactory Repository'
        required: true
        default: 'prat-ctap-shared-market-dev.dock.merck.com'
      
      ECR_REPOSITORY:
        description: 'Provide ECR REpository name eg prat-ctap-united-states'
        required: true
        default: ''

      ECR_IMAGE_TAG:
        description: 'Provide Image Tag eg all-product-ctap-destination-v2'
        required: true
        default: ''


jobs:

  build:  
    runs-on: ubuntu-latest
    env:
      Docker_Config: /opt/jenkins/workspace/container-test/docker_config
      
    steps:
    - uses: actions/checkout@v4
    - name: Installing AWS CLI
      id: install-aws-cli
      uses: unfor19/install-aws-cli-action@v1
      
    -  run: |
        aws --version
        
    - name: Build the Docker image
      run: |
        echo "${{env.AWS_Credentials}}"
        echo "${{env.Docker_Config}}"
        echo "${{inputs.AWS_Region}}"

    - name: Replacing variable
      run: |
        echo "${{inputs.AWS_Region}} | sed 's/-/_/g'"
        Region=$(echo ${{inputs.AWS_Region}} | sed 's/-/_/g')
        echo "$Region"
        echo "Region=$Region" >> $GITHUB_ENV
        echo "${{ env.Region }}"
        aws --version

    - name: Working on Github output
      id: vars
      run: |
        Reg="e-u-t"
        Reg=$(echo $Reg | sed 's/-/_/g')
        echo "$Reg"
        echo "Reg=$Reg" >> $GITHUB_OUTPUT

    - name: Accesing variable
      run: |
        echo "${{env.Region}}"
        echo "${{steps.vars.outputs.Reg}}"
